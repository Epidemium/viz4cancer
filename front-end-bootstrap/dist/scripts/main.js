"use strict";function fake_data(){return console.log("generate fake data"),{data:[{x:[1,2,3],y:[1,2,3]}],layout:{}}}function simulate_data(){return{data:[{type:"bar",inherit:!1,x:["giraffes","orangutans","monkeys"],y:[20,14,23],name:"SF Zoo",filename:"r-docs/simple-bar"}],layout:{xaxis:{title:'c("giraffes", "orangutans", "monkeys")'},yaxis:{title:"c(20, 14, 23)"},margin:{b:40,l:60,t:25,r:10}},url:{},width:{},height:{},base_url:"https://plot.ly"}}function adjust_height(e){var a=arguments.length<=1||void 0===arguments[1]?"500px":arguments[1];return"undefined"==typeof e.height?a:e.height}function append_section(e,a){var t=Date.now(),n=t+"_section",c=t+"_timeseries",r=$("<div/>",{"class":"row",id:n}),s=$("<div/>",{"class":"col-sm-10",id:c,style:"height:500px;"}),i=$("<div/>",{"class":"col-sm-2",id:c});return $(e).prepend(r),r.prepend(s),r.append(i),{section:r[0],timeseries:s[0],sidebar:i[0]}}function suppress_timeserie(e,a){$(e).remove(),$(a).remove()}function generate_graph(e,a,t){var n=append_section(e);adjust_height(a.layout),Plotly.newPlot(n.timeseries,a.data,a.layout),create_sidebar_button(e,n.timeseries,n.sidebar,t)}function update_factor(e,a,t){var n=epidemium_config.graph_url;a.factor=[],a.factor.push(t);var c="data="+JSON.stringify(a);$.post(n,c).done(function(t){var n=JSON.parse(t[0]);generate_graph(e,n,a)}),a.factor=[]}function create_sidebar_button(e,a,t,n){var c=$(t).attr("id"),r=c+"_suppress",s=c+"_age",i=c+"_sex",d=$("<div/>",{"class":"row",id:r}),o=$("<img/>",{src:"images/suppress_button.jpg",width:50,height:50}),u=$("<div/>",{"class":"row",id:s}),l=$("<img/>",{src:"images/age_button.jpg",width:50,height:50}),p=$("<div/>",{"class":"row",id:i}),m=$("<img/>",{src:"images/sex_button.jpg",width:50,height:50});$(t).append(d),$(d).append(o),$(t).append(u),$(u).append(l),$(t).append(p),$(p).append(m),$(o).click(function(){suppress_timeserie(a,t)}),$(l).click(function(){update_factor(e,n,"age.agg")}),$(m).click(function(){update_factor(e,n,"sexe")})}function display_json(e,a){$(e).append(a)}function add_plot(e,a){var t="data="+JSON.stringify(e),n=epidemium_config.graph_url;$.post(n,t,"json").done(function(t){var n=JSON.parse(t[0]);generate_graph(a,n,e)})}function add_plot_local_only(e,a,t){var n=simulate_data();generate_graph(t,n,a)}function create_list_div(e,a){var t=$("<div/>",{"class":"list-group-item data-item",text:" "+a,id:"data|"+e});return t.prepend($("<span/>",{"class":"glyphicon glyphicon-move","aria-hidden":"true",style:"float:right;"})),t}function add_elements_in_datalist(e){var a=$("#datalist");a.empty();for(var t=0;t<e.length;t++){var n=e[t];a.append(create_list_div(n[0],n[1]))}}function update_data_list(){var e=epidemium_config.data_lists,a=$("#data-text-search").val().toLowerCase().split(" ");if(a){for(var t=[],n=0;n<e.length;n++){for(var c=e[n],r=!0,s=0;s<a.length;s++)c[0].toLowerCase().indexOf(a[s])<0&c[1].toLowerCase().indexOf(a[s])<0&&(r=!1);r&&t.push(c)}t||add_elements_in_datalist(e),add_elements_in_datalist(t)}else add_elements_in_datalist(e)}function set_drag_drop(){var e=document.getElementById("datalist");Sortable.create(e,{group:{name:"datalist",pull:"clone",put:!1}});var a=document.getElementById("datadest");Sortable.create(a,{group:{name:"datadest",pull:!1,put:["datalist"]},animation:0,onAdd:function(e){var a=e.item,t=$("<span/>",{"class":"glyphicon glyphicon-remove",style:"float:left;color:red;"});t.mousedown(function(){a.remove()}),$(a).append(t)}})}function get_data_name_from_div(e){return $(e).attr("id").split("|")[1]}function get_parameters_and_create_graph(){var e=document.getElementById("main_pannel"),a=[];if($("#datadest").children(".data-item").each(function(e,t){var n=get_data_name_from_div(t);a.indexOf(n)<0&&a.push(n)}),console.log(a),a.length<1)add_plot_local_only("rien","rien",e);else{var t={};t.var1=a[0],a.length>1&&(t.var2=a[1],t.factor=[]),add_plot(t,e)}}var epidemium_config={graph_url:"http://viz4cancer.epidemium.cc:8001/plotPost2",data_lists:[["estomac.inc","cancer de l'estomac (indicences)"],["foie.inc","cancer du foie (indicences)"],["larynx.inc","cancer du larynx (indicences)"],["melanome.de.la.peau.inc","cancer du mélanome de la peau (indicences)"],["oesophage.inc","cancer de l'oesophage (indicences)"],["pancreas.inc","cancer du pancréas (indicences)"],["poumon.inc","cancer du poumon (indicences)"],["rein.inc","cancer du rein (indicences)"],["colon.rectum.inc","cancer du colon (indicences)"],["systeme.nerveux.cent.inc","cancer du système nerveux central (indicences)"],["tous.cancers.inc","cancer (total, indicences)"],["levre.bouche.pharynx.inc","cancer lèvre bouche pharynx (indicences)"],["vessie.inc","cancer de la vessie (indicences)"],["colon.rectum.deces","cancer du colon (décès)"],["estomac.deces","cancer de l'estomac (décès)"],["larynx.deces","cancer du larynx (décès)"],["oesophage.deces","cancer de l'oesophage (décès)"],["ovaire.deces","cancer des ovaires (décès)"],["poumon.deces","cancer du poumon (décès)"],["rein.deces","cancer du rein (décès)"],["systeme.nerveux.cent.deces","cancer du système nerveux central (décès)"],["tous.cancers.deces","cancer (total, décès)"],["levre.bouche.pharynx.deces","cancer lèvre bouche pharynx (décès)"],["vessie.deces","cancer de la vessie (décès)"],["sein.deces","cancer du sein (décès)"],["thyroide.inc","cancer de la thyroïde (incidences)"],["thyroide.deces","cancer de la thyroïde (décès)"],["tabac.part.depense","facteur: part des dépenses en tabac"],["tabac.volume.par.personne.euro","facteur: dépenses des foyers en tabac"],["part.obesite","facteur: taux d'obésité"],["part.surpoids","facteur: part de surpoids"],["ammoniac.france","facteur: rejets d'ammoniac (France)"],["ammoniac.ue","facteur: rejets d'ammoniac (U.E.)"],["composes.organiques.volatiles.autres.que.methane.france","facteur: rejets de composés organiques (France)"],["composes.organiques.volatiles.autres.que.methane.ue","facteur: rejets de composés organiques (U.EU)"],["oxydes.d.azote.france","facteur: rejets d'azote (France)"],["oxydes.de.soufre.france","facteur: rejets de soufre (France)"],["oxydes.d.azote.ue","facteur: rejets d'azote (U.E.)"],["oxydes.de.soufre.ue","facteur: rejets de soufre (U.E.)"]]};$(document).ready(function(){console.log("starting when dom ready"),set_drag_drop(),update_data_list(),$("#data-text-search").keyup(update_data_list),$("#createbutton").click(get_parameters_and_create_graph)});